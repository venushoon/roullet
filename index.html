<!DOCTYPE html>
<html lang="ko" data-theme="dark">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>룰렛 프로그램 | Roullet</title>
<style>
  :root{
    --bg-1:#0f1220; --bg-2:#171a2b; --panel:#1b2142cc;
    --text:#e9ecf1; --muted:#9aa3b2;
    --primary:#5865F2; --primary-2:#7c8bff;
    --accent:#22c55e; --danger:#ef4444; --warn:#f59e0b;
    --ring:0 0 0 3px rgba(88,101,242,.28); --shadow:0 10px 30px rgba(0,0,0,.35); --radius:16px;
    --chip-bg:#222a54; --chip-br:#33408a; --chip-tx:#dfe5ff;
    --input-bg:#0f1433; --input-br:#2f3566;
    --btn1:#2a33a8; --btn2:#1b2088; --btn-br:#4b57ff66;
    --ghost-bg:#0e1435; --ghost-br:#2d3470; --ghost-tx:#d7dcff;
    --panel-line:#2a2f55; --section-bg:#12173180;
  }
  html[data-theme="light"]{
    --bg-1:#f6f7fb; --bg-2:#eef1fb; --panel:#ffffffee;
    --text:#101322; --muted:#4b5570;
    --primary:#3743d9; --primary-2:#4d5cff;
    --accent:#16a34a; --danger:#dc2626; --warn:#d97706;
    --ring:0 0 0 3px rgba(77,92,255,.25); --shadow:0 10px 30px rgba(10,14,40,.12);
    --chip-bg:#e8ecff; --chip-br:#c9d1ff; --chip-tx:#132055;
    --input-bg:#ffffff; --input-br:#c9cfef;
    --btn1:#4d5cff; --btn2:#3743d9; --btn-br:#4b57ff66;
    --ghost-bg:#f3f5ff; --ghost-br:#c9d1ff; --ghost-tx:#1a237e;
    --panel-line:#e2e7ff; --section-bg:#f7f8ff;
  }
  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; color:var(--text);
    font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR","Apple SD Gothic Neo","Malgun Gothic",sans-serif;
    background:
      radial-gradient(1200px 600px at 20% 0%, #1f294e33, transparent 60%),
      radial-gradient(800px 600px at 100% 100%, #2a3a8a30, transparent 60%),
      linear-gradient(180deg,var(--bg-1),var(--bg-2));
  }
  .wrap{display:grid;grid-template-columns:minmax(320px,1fr) 400px;gap:20px;height:100%;padding:20px}
  .panel{background:var(--panel);backdrop-filter:blur(8px);border:1px solid var(--panel-line);border-radius:var(--radius);box-shadow:var(--shadow)}
  .left{position:relative;display:grid;grid-template-rows:auto 1fr;align-items:center;justify-items:center;padding:24px}
  .title{width:100%;display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:12px}
  .title h1{font-size:18px;font-weight:800;margin:0;letter-spacing:.2px;opacity:.9}
  /* ▼ 역삼각형 포인터 */
  .pointer{position:absolute;top:86px;left:50%;transform:translateX(-50%);width:0;height:0;border-left:18px solid transparent;border-right:18px solid transparent;border-top:28px solid #ff5a5a;filter:drop-shadow(0 10px 14px rgba(0,0,0,.45))}
  .canvas-box{width:min(90vmin,900px);aspect-ratio:1/1;display:grid;place-items:center}
  canvas{width:100%;height:100%}
  .right{display:flex;flex-direction:column;padding:18px;gap:14px}
  .section{padding:14px;border-radius:12px;background:var(--section-bg);border:1px solid var(--panel-line)}
  .section h2{font-size:14px;font-weight:800;letter-spacing:.4px;margin:0 0 10px 0;color:var(--primary-2);text-transform:uppercase}
  .input-row{display:flex;gap:10px;align-items:center}
  .input{flex:1;padding:12px 14px;border-radius:12px;border:1px solid var(--input-br);background:var(--input-bg);color:var(--text);outline:none;transition:box-shadow .15s,border-color .15s;font-size:15px}
  .input::placeholder{color:var(--muted)} .input:focus{box-shadow:var(--ring);border-color:var(--primary-2)}
  .btn{all:unset;display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:12px 14px;border-radius:12px;cursor:pointer;color:#fff;font-weight:800;letter-spacing:.2px;font-size:14px;background:linear-gradient(180deg,var(--btn1),var(--btn2));border:1px solid var(--btn-br);box-shadow:0 10px 20px rgba(37,48,140,.35);transition:transform .08s ease,filter .2s ease}
  .btn:active{transform:translateY(1px)} .btn:hover{filter:brightness(1.05)}
  .btn-ghost{background:var(--ghost-bg);border:1px solid var(--ghost-br);box-shadow:none;color:var(--ghost-tx)}
  .btn-success{background:linear-gradient(180deg,#22c55e,#16a34a);border-color:#34d39944}
  .btn-warning{background:linear-gradient(180deg,var(--warn),#d97706);border-color:#fbbf2444;color:#1b1203}
  .note{color:var(--muted);font-size:12px}
  /* 결과 뱃지 */
  .result-toast{position:absolute;inset:auto 0 16px 0;display:grid;place-items:center;pointer-events:none}
  .result-badge{display:inline-block;padding:10px 14px;border-radius:999px;font-size:18px;font-weight:900;background:#11163aee;border:1px solid #33408a;box-shadow:var(--shadow)}
  /* 항목칩은 기본 숨김 */
  #chipWrap{display:none}
  .chip{display:inline-flex;align-items:center;gap:8px;background:var(--chip-bg);color:var(--chip-tx);border:1px solid var(--chip-br);padding:8px 10px;border-radius:999px;font-size:13px}
  .chip button{background:transparent;border:none;color:var(--muted);cursor:pointer;padding:0;line-height:1;font-weight:900}
  .grid-2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  @media (max-width:980px){.wrap{grid-template-columns:1fr}.pointer{top:76px}}
</style>
</head>
<body>
  <div class="wrap">
    <!-- LEFT -->
    <div class="panel left">
      <div class="title">
        <h1>🎡 룰렛</h1>
        <div style="display:flex;gap:8px">
          <button class="btn btn-success" id="btnStart">
            <svg viewBox="0 0 24 24" width="18" height="18"><path d="M8 5l11 7-11 7V5z" fill="currentColor"/></svg> 추첨 시작
          </button>
          <button class="btn btn-ghost" id="btnReset">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none"><path d="M4 4v6h6M20 20v-6h-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M20 10a8 8 0 10-3.3 6.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg> 초기화
          </button>
        </div>
      </div>
      <div class="pointer" aria-hidden="true"></div>
      <div class="canvas-box"><canvas id="wheel" width="900" height="900"></canvas></div>
      <div class="result-toast" aria-live="polite" aria-atomic="true">
        <div id="resultBadge" class="result-badge" style="display:none"></div>
      </div>
    </div>

    <!-- RIGHT -->
    <aside class="panel right">
      <div class="section">
        <h2>입력</h2>
        <div class="input-row">
          <input id="itemInput" class="input" type="text" placeholder="한 줄에 1개 입력 후 Enter" />
          <button class="btn" id="btnAdd">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg> Add
          </button>
        </div>
        <div class="note" style="margin-top:6px">
          • 칩 목록은 기본 숨김입니다. <button class="btn btn-ghost" id="btnToggleList" style="padding:6px 10px;font-size:12px">항목 보기/숨기기</button>
          <span id="countInfo"></span>
        </div>
        <div id="chipWrap" class="section" style="margin-top:10px">
          <div id="chipList" style="display:flex;flex-wrap:wrap;gap:8px"></div>
        </div>
      </div>

      <div class="section stack-vert">
        <h2>옵션</h2>
        <div class="grid-2">
          <button class="btn" id="btnShuffle">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none"><path d="M16 3h5v5M3 8a6 6 0 006 6h2a6 6 0 006 6h5v-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg> 항목 섞기
          </button>
          <button class="btn" id="btnBig">
            <svg viewBox="0 0 24 24" width="18" height="18" fill="none"><path d="M3 5h18v12H3zM8 21h8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg> 대형 룰렛
          </button>
        </div>
        <label style="display:flex;align-items:center;gap:10px;margin-top:6px"><input id="chkDupe" type="checkbox" /> 뽑기 중복 허용</label>
        <label style="display:flex;align-items:center;gap:10px;margin-top:6px"><input id="chkTheme" type="checkbox" /> 밝은(프로젝터) 모드</label>
      </div>

      <div class="section">
        <h2>화면 조정</h2>
        <div class="grid-2">
          <button class="btn btn-ghost" id="btnZoomIn">＋ 확대</button>
          <button class="btn btn-ghost" id="btnZoomOut">－ 축소</button>
        </div>
        <div style="margin-top:8px" class="stack-vert">
          <button class="btn btn-warning" id="btnZoomReset">기본 설정</button>
        </div>
      </div>
    </aside>
  </div>

<script>
/* ------------ State ------------ */
let items = ["1. 글자의 문제는?","2. 생각의 문제는?","3. 호주의 수도는?","4. 미국의 수도는?"]; // 예시
let allowDuplicate = false;
let angle = 0;            // 현재 각도(rad), 시계방향 +
let spinning = false;
const TWO_PI = Math.PI * 2;
const POINTER_ANGLE = -Math.PI/2; // 포인터는 화면 위쪽(12시)

/* DOM */
const canvas = document.getElementById('wheel');
const ctx = canvas.getContext('2d');
const ipt = document.getElementById('itemInput');
const chipWrap = document.getElementById('chipWrap');
const chipList = document.getElementById('chipList');
const countInfo = document.getElementById('countInfo');
const resultBadge = document.getElementById('resultBadge');

/* ------------ Utils ------------ */
const rand = (a,b)=>Math.random()*(b-a)+a;
const clamp = (v,a,b)=>Math.max(a,Math.min(b,v));
const norm = a => (a%TWO_PI+TWO_PI)%TWO_PI;
const escapeHtml = s => s.replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;' }[m]));

/* ------------ Draw Wheel ------------ */
function drawWheel(){
  const W=canvas.width,H=canvas.height;
  ctx.clearRect(0,0,W,H);
  ctx.save();
  ctx.translate(W/2,H/2);
  ctx.rotate(angle);

  const n=Math.max(items.length,1);
  const arc=TWO_PI/n;
  const R=Math.min(W,H)/2-14;

  for(let i=0;i<n;i++){
    const s=i*arc, e=s+arc;
    const hue=Math.floor((360/n)*i);
    ctx.beginPath(); ctx.moveTo(0,0); ctx.arc(0,0,R,s,e); ctx.closePath();
    ctx.fillStyle=`hsl(${hue} 75% 52%)`; ctx.fill();

    ctx.strokeStyle="rgba(5,10,30,.6)"; ctx.lineWidth=6;
    ctx.beginPath(); ctx.arc(0,0,R,s,e); ctx.stroke();

    // 라벨
    ctx.save(); ctx.rotate(s+arc/2);
    const r = R*0.72;
    ctx.fillStyle="rgba(4,7,22,.35)";
    roundedRect(ctx, r-84, -22, 168, 44, 12); ctx.fill();
    ctx.fillStyle="#fff"; ctx.textAlign="center"; ctx.textBaseline="middle";
    ctx.font="700 30px ui-sans-serif,system-ui,'Noto Sans KR'";
    ctx.fillText(items[i]??"", r, 0);
    ctx.restore();
  }
  // 허브
  ctx.beginPath(); ctx.arc(0,0,80,0,TWO_PI);
  const g=ctx.createRadialGradient(0,0,12,0,0,80); g.addColorStop(0,"#2b3aa5"); g.addColorStop(1,"#131b5e");
  ctx.fillStyle=g; ctx.fill();
  ctx.restore();
}
function roundedRect(ctx,x,y,w,h,r){
  ctx.beginPath(); ctx.moveTo(x+r,y);
  ctx.arcTo(x+w,y,x+w,y+h,r);
  ctx.arcTo(x+w,y+h,x,y+h,r);
  ctx.arcTo(x,y+h,x,y,r);
  ctx.arcTo(x,y,x+w,y,r);
  ctx.closePath();
}

/* ------------ Spin (exact stop, smooth decay) ------------ */
/** 섹터 중앙에 정확히 멈추는 목표각 계산 */
function targetAngleForIndex(index){
  const n=items.length; const arc=TWO_PI/n;
  const centerAtPointer = (index+0.5)*arc; // 포인터 기준 섹터 중앙각
  const base = POINTER_ANGLE - centerAtPointer; // 이 각으로 멈추면 포인터가 중앙을 가리킴
  const delta = norm(base - angle);            // 현재 각도에서 base까지의 상대각(양수)
  const turns = Math.floor(rand(6,8));         // 6~7 바퀴
  return angle + turns*TWO_PI + delta;
}
/** 시각·결과 완전 일치 보장 스핀 */
function spin(){
  if(spinning || items.length===0) return;
  hideResult(); spinning=true;

  // 1) 당첨 섹터를 먼저 고름
  const winIdx = Math.floor(rand(0, items.length));
  const target = targetAngleForIndex(winIdx);

  // 2) 감속 애니메이션 (ease-out³)
  const start = angle;
  const duration = rand(3500, 5200); // 3.5~5.2s
  const t0 = performance.now();

  (function anim(now){
    const t = clamp((now - t0) / duration, 0, 1);
    const ease = 1 - Math.pow(1 - t, 3); // easeOutCubic
    angle = start + (target - start) * ease;
    drawWheel();
    if (t < 1) {
      requestAnimationFrame(anim);
    } else {
      // 3) 정밀 정렬: 숫자 오차 보정
      angle = target; drawWheel();
      showResult(winIdx);
      spinning = false;
    }
  })(t0);
}

/* 결과 표시 (항상 포인터와 일치) */
function showResult(index){
  const pick = items[index];
  resultBadge.textContent = `🎉 당첨: ${pick}`;
  resultBadge.style.display = 'inline-block';
  if(!allowDuplicate){
    items.splice(index,1);
    refreshCount(); renderChips(); drawWheel();
  }
}
function hideResult(){ resultBadge.style.display='none' }

/* ------------ Index 계산(디버그용) ------------ */
function getIndexAtPointer(){
  const n=Math.max(items.length,1), arc=TWO_PI/n;
  const rel = norm(POINTER_ANGLE - angle);      // 포인터에서 본 현재 기준각
  return Math.floor(rel / arc) % n;
}

/* ------------ Input ------------ */
/* 한글 IME 조합 이슈 방지 + 중복 방지 */
let composing=false, lastAdded='', lastAt=0;
ipt.addEventListener('compositionstart',()=>composing=true);
ipt.addEventListener('compositionend',()=>{composing=false});
function sanitize(raw){
  let v=(raw||'').replace(/\s+/g,' ').trim().replace(/[,\u3001;\/\\]+$/,'').trim();
  if(v==='등') return ''; // 흔한 오입력
  return v;
}
function addFromInput(){
  if(composing) return;
  const v = sanitize(ipt.value);
  if(!v) return;
  const now = Date.now();
  if(v===lastAdded && (now-lastAt)<500) return; // 빠른 중복 차단
  items.push(v); lastAdded=v; lastAt=now;
  ipt.value=''; refreshCount(); renderChips(); drawWheel();
}
ipt.addEventListener('keydown', e=>{ if(e.key==='Enter' && !composing){ e.preventDefault(); addFromInput(); }});
document.getElementById('btnAdd').addEventListener('click', addFromInput);

/* 칩 보기 토글(기본 숨김) */
document.getElementById('btnToggleList').addEventListener('click', ()=>{
  chipWrap.style.display = chipWrap.style.display==='none' ? '' : 'none';
});
function renderChips(){
  chipList.innerHTML='';
  items.forEach((v,i)=>{
    const el=document.createElement('span');
    el.className='chip';
    el.innerHTML=`<span>${escapeHtml(v)}</span> <button data-i="${i}">✕</button>`;
    chipList.appendChild(el);
  });
}
chipList.addEventListener('click', e=>{
  if(e.target.tagName==='BUTTON'){
    const i=+e.target.dataset.i;
    items.splice(i,1);
    refreshCount(); renderChips(); drawWheel();
  }
});
function refreshCount(){ countInfo.textContent = ` (항목: ${items.length}개)`; }

/* ------------ Options ------------ */
document.getElementById('chkDupe').addEventListener('change', e=>{ allowDuplicate = e.target.checked; });
document.getElementById('chkTheme').addEventListener('change', e=>{
  document.documentElement.setAttribute('data-theme', e.target.checked ? 'light' : 'dark');
});
document.getElementById('btnShuffle').addEventListener('click', ()=>{ items.sort(()=>Math.random()-0.5); renderChips(); drawWheel(); });
document.getElementById('btnStart').addEventListener('click', ()=>spin());
document.getElementById('btnReset').addEventListener('click', ()=>{ angle=0; drawWheel(); hideResult(); });

let zoom=1;
document.getElementById('btnZoomIn').addEventListener('click', ()=>{ zoom = clamp(zoom+0.1,.6,1.6); document.querySelector('.left').style.transform=`scale(${zoom})`; document.querySelector('.left').style.transformOrigin='top left'; });
document.getElementById('btnZoomOut').addEventListener('click', ()=>{ zoom = clamp(zoom-0.1,.6,1.6); document.querySelector('.left').style.transform=`scale(${zoom})`; document.querySelector('.left').style.transformOrigin='top left'; });
document.getElementById('btnZoomReset').addEventListener('click', ()=>{ zoom=1; document.querySelector('.left').style.transform='none'; });

/* ------------ Big Screen (same theme/items) ------------ */
document.getElementById('btnBig').addEventListener('click', ()=>{
  const w = window.open('', '_blank', 'width=1200,height=1000');
  w.document.write(bigHtml(document.documentElement.getAttribute('data-theme')||'dark', items, allowDuplicate, angle));
  w.document.close();
});
function bigHtml(theme, itemsInit, dupe, ang){
  return `<!DOCTYPE html><html lang="ko" data-theme="${theme}"><head><meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" /><title>대형 룰렛</title>
<style>
:root{--bg:#0a0d1f;--tx:#fff} html[data-theme="light"]{--bg:#f6f7fb;--tx:#101322}
html,body{height:100%;margin:0;background:var(--bg);color:var(--tx);font-family:ui-sans-serif,system-ui,'Noto Sans KR',sans-serif}
.stage{display:grid;place-items:center;height:100%;gap:16px}
.pointer{width:0;height:0;border-left:20px solid transparent;border-right:20px solid transparent;border-top:30px solid #ff5a5a;filter:drop-shadow(0 10px 14px rgba(0,0,0,.45))}
canvas{width:min(92vmin,1200px);height:min(92vmin,1200px)}
.controls{position:fixed;right:16px;top:16px;display:flex;gap:8px}
.btn{all:unset;background:#1a1f42d9;border:1px solid #3a47b8aa;padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:800}
html[data-theme="light"] .btn{background:#ffffffdd;border-color:#c9d1ff;color:#1a237e}
</style></head><body>
<div class="controls"><button class="btn" id="start">▶ 시작</button><button class="btn" id="reset">↺ 초기화</button></div>
<div class="stage"><div class="pointer"></div><canvas id="C" width="1400" height="1400"></canvas><div id="R" style="font-size:28px;font-weight:900"></div></div>
<script>
const TWO_PI=Math.PI*2, POINTER_ANGLE=-Math.PI/2;
const C=document.getElementById('C'), X=C.getContext('2d');
let items=${JSON.stringify(itemsInit)}, allow=${dupe?'true':'false'}, angle=${ang||0}, spinning=false;
function draw(){
  const W=C.width,H=C.height; X.clearRect(0,0,W,H);
  X.save(); X.translate(W/2,H/2); X.rotate(angle);
  const n=Math.max(items.length,1), arc=TWO_PI/n, R=Math.min(W,H)/2-16;
  for(let i=0;i<n;i++){
    const s=i*arc,e=s+arc,hue=Math.floor((360/n)*i);
    X.beginPath(); X.moveTo(0,0); X.arc(0,0,R,s,e); X.closePath(); X.fillStyle=\`hsl(\${hue} 75% 52%)\`; X.fill();
    X.strokeStyle="rgba(5,10,30,.55)"; X.lineWidth=8; X.beginPath(); X.arc(0,0,R,s,e); X.stroke();
    X.save(); X.rotate(s+arc/2); const r=R*0.72; X.fillStyle="rgba(4,7,22,.35)";
    X.fillRect(r-90,-22,180,44); X.fillStyle="#fff"; X.font="700 42px ui-sans-serif,'Noto Sans KR'";
    X.textAlign="center"; X.textBaseline="middle"; X.fillText(items[i]??"", r, 0); X.restore();
  } X.restore();
}
function targetAngleForIndex(i){ const n=items.length, arc=TWO_PI/n; const base=POINTER_ANGLE - (i+0.5)*arc; const delta=((base-angle)%TWO_PI+TWO_PI)%TWO_PI; const turns=6; return angle + turns*TWO_PI + delta; }
function spin(){
  if(spinning||items.length===0) return; spinning=true;
  const idx=Math.floor(Math.random()*items.length); const target=targetAngleForIndex(idx);
  const start=angle, dur=3800+Math.random()*1200, t0=performance.now();
  (function anim(now){ const t=Math.min((now-t0)/dur,1); const ease=1-Math.pow(1-t,3); angle=start+(target-start)*ease; draw();
    if(t<1) requestAnimationFrame(anim); else { angle=target; draw(); document.getElementById('R').textContent='🎉 '+items[idx]+' 🎉'; if(!allow){ items.splice(idx,1); draw(); } spinning=false; }
  })(t0);
}
document.getElementById('start').onclick=spin; document.getElementById('reset').onclick=()=>{angle=0;draw();document.getElementById('R').textContent='';}; draw();
<\/script></body></html>`;
}

/* ------------ Init ------------ */
function renderChips(){ // (열었을 때만 보이도록)
  chipList.innerHTML='';
  items.forEach((v,i)=>{
    const el=document.createElement('span');
    el.className='chip';
    el.innerHTML=`<span>${escapeHtml(v)}</span> <button data-i="${i}">✕</button>`;
    chipList.appendChild(el);
  });
}
function refreshCount(){ countInfo.textContent = ` (항목: ${items.length}개)`; }
function roundedRect(ctx,x,y,w,h,r){ ctx.beginPath(); ctx.moveTo(x+r,y); ctx.arcTo(x+w,y,x+w,y+h,r); ctx.arcTo(x+w,y+h,x,y+h,r); ctx.arcTo(x,y+h,x,y,r); ctx.arcTo(x,y,x+w,y,r); ctx.closePath(); }
document.getElementById('btnShuffle').addEventListener('click',()=>{ items.sort(()=>Math.random()-0.5); renderChips(); drawWheel(); });
document.getElementById('btnStart').addEventListener('click',()=>spin());
document.getElementById('btnReset').addEventListener('click',()=>{ angle=0; drawWheel(); hideResult(); });
document.getElementById('btnZoomIn').addEventListener('click',()=>{ const left=document.querySelector('.left'); left.style.transformOrigin='top left'; left.style.transform=`scale(${(window._z=(window._z||1)+.1)})`; });
document.getElementById('btnZoomOut').addEventListener('click',()=>{ const left=document.querySelector('.left'); left.style.transformOrigin='top left'; left.style.transform=`scale(${(window._z=(window._z||1)-.1)})`; });
document.getElementById('btnZoomReset').addEventListener('click',()=>{ const left=document.querySelector('.left'); window._z=1; left.style.transform='none'; });

/* 입력 이벤트 */
let composing=false; ipt.addEventListener('compositionstart',()=>composing=true); ipt.addEventListener('compositionend',()=>composing=false);
let lastAdded='', lastAt=0;
function addFromInput(){
  if(composing) return;
  let v=(ipt.value||'').replace(/\s+/g,' ').trim().replace(/[,\u3001;\/\\]+$/,'').trim();
  if(!v || v==='등') return;
  const now=Date.now(); if(v===lastAdded && now-lastAt<500) return;
  items.push(v); lastAdded=v; lastAt=now; ipt.value=''; refreshCount(); renderChips(); drawWheel();
}
ipt.addEventListener('keydown',e=>{ if(e.key==='Enter'&&!composing){ e.preventDefault(); addFromInput(); }});
document.getElementById('btnAdd').addEventListener('click', addFromInput);

/* 시작 */
refreshCount(); renderChips(); drawWheel();
</script>
</body>
</html>
