<!DOCTYPE html>
<html lang="ko" data-theme="dark">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ë£°ë › í”„ë¡œê·¸ë¨ | Roullet</title>
<style>
  /* ===== THEME TOKENS ===== */
  :root{
    --bg-1:#0f1220; --bg-2:#171a2b; --panel:#1b2142cc;
    --text:#e9ecf1; --muted:#9aa3b2;
    --primary:#5865F2; --primary-2:#7c8bff;
    --accent:#22c55e; --danger:#ef4444; --warn:#f59e0b;
    --ring: 0 0 0 3px rgba(88,101,242,.28);
    --shadow: 0 10px 30px rgba(0,0,0,.35);
    --radius:16px;
    --chip-bg:#222a54; --chip-br:#33408a; --chip-tx:#dfe5ff;
    --input-bg:#0f1433; --input-br:#2f3566;
    --btn-grad-1:#2a33a8; --btn-grad-2:#1b2088; --btn-br:#4b57ff66;
    --ghost-bg:#0e1435; --ghost-br:#2d3470; --ghost-tx:#d7dcff;
    --panel-line:#2a2f55; --section-bg:#12173180;
  }
  /* Projector-friendly high-contrast light theme */
  html[data-theme="light"]{
    --bg-1:#f6f7fb; --bg-2:#eef1fb; --panel:#ffffffee;
    --text:#101322; --muted:#4b5570;
    --primary:#3743d9; --primary-2:#4d5cff;
    --accent:#16a34a; --danger:#dc2626; --warn:#d97706;
    --ring:0 0 0 3px rgba(77,92,255,.25);
    --shadow: 0 10px 30px rgba(10,14,40,.12);
    --chip-bg:#e8ecff; --chip-br:#c9d1ff; --chip-tx:#132055;
    --input-bg:#ffffff; --input-br:#c9cfef;
    --btn-grad-1:#4d5cff; --btn-grad-2:#3743d9; --btn-br:#4b57ff66;
    --ghost-bg:#f3f5ff; --ghost-br:#c9d1ff; --ghost-tx:#1a237e;
    --panel-line:#e2e7ff; --section-bg:#f7f8ff;
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0;
    font-family: ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans KR","Apple SD Gothic Neo","Malgun Gothic",sans-serif;
    color:var(--text);
    background:
      radial-gradient(1200px 600px at 20% 0%, #1f294e33, transparent 60%),
      radial-gradient(800px 600px at 100% 100%, #2a3a8a30, transparent 60%),
      linear-gradient(180deg, var(--bg-1), var(--bg-2));
  }
  .wrap{
    display:grid; grid-template-columns:minmax(320px,1fr) 400px;
    gap:20px; height:100%; padding:20px;
  }
  .panel{
    background:var(--panel); backdrop-filter:blur(8px);
    border:1px solid var(--panel-line); border-radius:var(--radius);
    box-shadow:var(--shadow);
  }

  /* LEFT */
  .left{ position:relative; display:grid; grid-template-rows:auto 1fr; align-items:center; justify-items:center; padding:24px; }
  .title{ width:100%; display:flex; align-items:center; justify-content:space-between; gap:12px; margin-bottom:12px; }
  .title h1{ font-size:18px; font-weight:800; margin:0; letter-spacing:.2px; opacity:.9; }
  .pointer {
    position:absolute; top:86px; left:50%; transform:translateX(-50%);
    width:0; height:0;
    border-left: 18px solid transparent;
    border-right:18px solid transparent;
    /* â–¼ inverted triangle (points down to wheel) */
    border-bottom:0 solid transparent;
    border-top: 28px solid #ff5a5a;  /* top colored makes tip downward-looking when placed above rim */
    filter: drop-shadow(0 10px 14px rgba(0,0,0,.45));
  }
  .canvas-box{ width:min(90vmin, 900px); aspect-ratio:1/1; display:grid; place-items:center; }
  canvas{ width:100%; height:100%; }

  /* RIGHT */
  .right{ display:flex; flex-direction:column; padding:18px; gap:14px; }
  .section{ padding:14px; border-radius:12px; background:var(--section-bg); border:1px solid var(--panel-line); }
  .section h2{ font-size:14px; font-weight:800; letter-spacing:.4px; margin:0 0 10px 0; color:var(--primary-2); text-transform:uppercase; }

  .input-row{ display:flex; gap:10px; align-items:center; }
  .input{
    flex:1; padding:12px 14px; border-radius:12px; border:1px solid var(--input-br);
    background:var(--input-bg); color:var(--text); outline:none; transition: box-shadow .15s, border-color .15s; font-size:15px;
  }
  .input::placeholder{ color:var(--muted) }
  .input:focus{ box-shadow:var(--ring); border-color:var(--primary-2); }

  .chips{ display:flex; flex-wrap:wrap; gap:8px; margin-top:10px; max-height:120px; overflow:auto; }
  .chip{ display:inline-flex; align-items:center; gap:8px; background:var(--chip-bg); color:var(--chip-tx); border:1px solid var(--chip-br); padding:8px 10px; border-radius:999px; font-size:13px; }
  .chip button{ background:transparent; border:none; color:var(--muted); cursor:pointer; padding:0; line-height:1; font-weight:900; }

  .grid-2{ display:grid; grid-template-columns:1fr 1fr; gap:10px; }
  .stack-vert{ display:flex; flex-direction:column; gap:8px; }
  .note{ color:var(--muted); font-size:12px }

  /* BUTTONS */
  .btn{
    all:unset; display:inline-flex; align-items:center; justify-content:center; gap:8px;
    padding:12px 14px; border-radius:12px; cursor:pointer;
    color:#fff; font-weight:800; letter-spacing:.2px; font-size:14px;
    background:linear-gradient(180deg, var(--btn-grad-1), var(--btn-grad-2));
    border:1px solid var(--btn-br); box-shadow:0 10px 20px rgba(37,48,140,.35);
    transition: transform .08s ease, filter .2s ease, background .2s ease; user-select:none;
  }
  .btn svg{ width:18px; height:18px; }
  .btn:active{ transform:translateY(1px) } .btn:hover{ filter:brightness(1.05) }
  .btn-ghost{ background:var(--ghost-bg); border:1px solid var(--ghost-br); box-shadow:none; color:var(--ghost-tx); }
  .btn-success{ background:linear-gradient(180deg, #22c55e, #16a34a); border-color:#34d39944; }
  .btn-danger{ background:linear-gradient(180deg, #ef4444, #dc2626); border-color:#ef444455; }
  .btn-warning{ background:linear-gradient(180deg, var(--warn), #d97706); border-color:#fbbf2444; color:#1b1203; }

  /* Result badge */
  .result-toast{ position:absolute; inset:auto 0 16px 0; display:grid; place-items:center; pointer-events:none; }
  .result-badge{ display:inline-block; padding:10px 14px; border-radius:999px; font-size:18px; font-weight:900; background:#11163aee; border:1px solid #33408a; box-shadow:var(--shadow); }

  @media (max-width: 980px){ .wrap{ grid-template-columns:1fr } .pointer{ top:76px } }
</style>
</head>
<body>
  <div class="wrap">
    <!-- LEFT -->
    <div class="panel left">
      <div class="title">
        <h1>ğŸ¡ ë£°ë ›</h1>
        <div style="display:flex; gap:8px">
          <button class="btn btn-success" id="btnStart">
            <!-- Play SVG -->
            <svg viewBox="0 0 24 24" fill="none"><path d="M8 5l11 7-11 7V5z" fill="currentColor"/></svg>
            ì¶”ì²¨ ì‹œì‘
          </button>
          <button class="btn btn-ghost" id="btnReset">
            <!-- Reset SVG -->
            <svg viewBox="0 0 24 24" fill="none"><path d="M4 4v6h6M20 20v-6h-6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M20 10a8 8 0 10-3.3 6.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            ì´ˆê¸°í™”
          </button>
        </div>
      </div>
      <div class="pointer" aria-hidden="true"></div>
      <div class="canvas-box"><canvas id="wheel" width="900" height="900"></canvas></div>
      <div class="result-toast" aria-live="polite" aria-atomic="true">
        <div id="resultBadge" class="result-badge" style="display:none"></div>
      </div>
    </div>

    <!-- RIGHT -->
    <aside class="panel right">
      <!-- ì…ë ¥ -->
      <div class="section">
        <h2>ì…ë ¥</h2>
        <div class="input-row">
          <input id="itemInput" class="input" type="text" placeholder="í•œ ì¤„ì— 1ê°œ ì…ë ¥ í›„ Enter" />
          <button class="btn" id="btnAdd">
            <!-- Plus SVG -->
            <svg viewBox="0 0 24 24" fill="none"><path d="M12 5v14M5 12h14" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            Add
          </button>
        </div>
        <div class="note" style="margin-top:6px">ì˜ˆ) í™ê¸¸ë™ â†µ, 1ë°˜ â†µ, ì´ˆì½œë¦¿ â†µ â€¦ <span style="font-weight:800">Enter</span> ë¡œ ì¶”ê°€</div>
        <div id="chipList" class="chips"></div>
      </div>

      <!-- ì˜µì…˜ -->
      <div class="section stack-vert">
        <h2>ì˜µì…˜</h2>
        <div class="grid-2">
          <button class="btn" id="btnShuffle">
            <!-- Shuffle SVG -->
            <svg viewBox="0 0 24 24" fill="none"><path d="M16 3h5v5M3 8a6 6 0 006 6h2a6 6 0 006 6h5v-5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
            í•­ëª© ì„ê¸°
          </button>
          <button class="btn" id="btnBig">
            <!-- Screen SVG -->
            <svg viewBox="0 0 24 24" fill="none"><path d="M3 5h18v12H3zM8 21h8" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            ëŒ€í˜• ë£°ë ›
          </button>
        </div>
        <label style="display:flex;align-items:center;gap:10px;margin-top:6px">
          <input id="chkDupe" type="checkbox" /> ë½‘ê¸° ì¤‘ë³µ í—ˆìš©
        </label>
        <label style="display:flex;align-items:center;gap:10px;margin-top:6px">
          <input id="chkTheme" type="checkbox" /> ë°ì€(í”„ë¡œì í„°) ëª¨ë“œ
        </label>
      </div>

      <!-- í™”ë©´ ì¡°ì • -->
      <div class="section">
        <h2>í™”ë©´ ì¡°ì •</h2>
        <div class="grid-2">
          <button class="btn btn-ghost" id="btnZoomIn">
            <!-- Zoom in SVG -->
            <svg viewBox="0 0 24 24" fill="none"><path d="M11 19a8 8 0 100-16 8 8 0 000 16z" stroke="currentColor" stroke-width="2"/><path d="M21 21l-4.3-4.3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M11 8v6M8 11h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            í™•ëŒ€
          </button>
          <button class="btn btn-ghost" id="btnZoomOut">
            <!-- Zoom out SVG -->
            <svg viewBox="0 0 24 24" fill="none"><path d="M11 19a8 8 0 100-16 8 8 0 000 16z" stroke="currentColor" stroke-width="2"/><path d="M21 21l-4.3-4.3" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M8 11h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            ì¶•ì†Œ
          </button>
        </div>
        <div class="stack-vert" style="margin-top:8px">
          <button class="btn btn-warning" id="btnZoomReset">
            <!-- Reset view SVG -->
            <svg viewBox="0 0 24 24" fill="none"><path d="M4 4v6h6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/><path d="M20 10a8 8 0 10-3.3 6.5" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            ê¸°ë³¸ ì„¤ì •
          </button>
        </div>
      </div>

      <!-- ì•ˆë‚´ -->
      <div class="section">
        <h2>ë„ì›€ë§</h2>
        <div class="note">
          â€¢ ê²°ê³¼ ë±ƒì§€ë¥¼ í´ë¦­í•˜ë©´ ìˆ¨ê²¨ì§‘ë‹ˆë‹¤.<br/>
          â€¢ ëŒ€í˜• ë£°ë ›ì€ í˜„ì¬ í•­ëª©/ì„¤ì •/í…Œë§ˆë¥¼ ìë™ ê³µìœ í•©ë‹ˆë‹¤.
        </div>
      </div>
    </aside>
  </div>

<script>
/* ===== STATE ===== */
let items = ["1ë“±","2ë“±","3ë“±","4ë“±","5ë“±","6ë“±"];
let allowDuplicate = false;
let angle = 0, spinning = false;
const TWO_PI = Math.PI * 2;

const canvas = document.getElementById('wheel');
const ctx = canvas.getContext('2d');
const chipList = document.getElementById('chipList');
const resultBadge = document.getElementById('resultBadge');

/* ===== UTILS ===== */
const rand = (min,max)=>Math.random()*(max-min)+min;
const shuffle = arr => arr.sort(()=>Math.random()-0.5);
const clamp = (v,a,b)=>Math.max(a,Math.min(b,v));
const escapeHtml = s => s.replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#039;' }[m]));

/* storage */
function saveState(){
  localStorage.setItem('roullet_items', JSON.stringify(items));
  localStorage.setItem('roullet_allowDupe', allowDuplicate?'1':'0');
  localStorage.setItem('roullet_theme', document.documentElement.getAttribute('data-theme')||'dark');
}
function loadState(){
  try{
    const s = localStorage.getItem('roullet_items'); if(s) items = JSON.parse(s);
  }catch{}
  allowDuplicate = localStorage.getItem('roullet_allowDupe')==='1';
  const theme = localStorage.getItem('roullet_theme') || 'dark';
  document.documentElement.setAttribute('data-theme', theme);
  document.getElementById('chkDupe').checked = allowDuplicate;
  document.getElementById('chkTheme').checked = theme==='light';
}

/* ===== DRAW WHEEL ===== */
function drawWheel(){
  const W=canvas.width,H=canvas.height;
  ctx.clearRect(0,0,W,H);
  ctx.save(); ctx.translate(W/2,H/2); ctx.rotate(angle);

  const n=Math.max(items.length,1);
  const arc=TWO_PI/n; const R=Math.min(W,H)/2-14;

  for(let i=0;i<n;i++){
    const start=i*arc, end=start+arc;
    const hue = Math.floor((360/n)*i);
    ctx.beginPath(); ctx.moveTo(0,0);
    ctx.arc(0,0,R,start,end); ctx.closePath();
    ctx.fillStyle=`hsl(${hue} 75% 52%)`; ctx.fill();

    ctx.strokeStyle="rgba(5,10,30,.6)"; ctx.lineWidth=6;
    ctx.beginPath(); ctx.arc(0,0,R,start,end); ctx.stroke();

    ctx.save(); ctx.rotate(start+arc/2);
    // label badge
    const badgeR = R*0.72;
    ctx.fillStyle = "rgba(4,7,22,.35)";
    roundedRect(ctx, badgeR-64, -20, 128, 40, 12); ctx.fill();
    ctx.fillStyle="#fff";
    ctx.font="700 34px ui-sans-serif, system-ui, 'Noto Sans KR'";
    ctx.textAlign="center"; ctx.textBaseline="middle";
    ctx.fillText(items[i]??"", badgeR, 0);
    ctx.restore();
  }

  // center hub
  ctx.beginPath(); ctx.arc(0,0,80,0,TWO_PI);
  const grd = ctx.createRadialGradient(0,0,12,0,0,80);
  grd.addColorStop(0,"#2b3aa5"); grd.addColorStop(1,"#131b5e");
  ctx.fillStyle=grd; ctx.fill();

  ctx.restore();
}
function roundedRect(ctx,x,y,w,h,r){
  ctx.beginPath();
  ctx.moveTo(x+r,y);
  ctx.arcTo(x+w,y,x+w,y+h,r);
  ctx.arcTo(x+w,y+h,x,y+h,r);
  ctx.arcTo(x,y+h,x,y,r);
  ctx.arcTo(x,y,x+w,y,r);
  ctx.closePath();
}

/* ===== SPIN ===== */
function spin(){
  if(spinning || items.length===0) return;
  hideResult(); spinning = true;

  const baseTurns = 6, extra = rand(0,360);
  const target = angle + (baseTurns*360 + extra) * (Math.PI/180);
  const duration = rand(3000, 4200);
  const startA = angle, t0 = performance.now();

  tickLoopStart();

  (function anim(now){
    const t = clamp((now - t0)/duration, 0, 1);
    const ease = t<.5 ? 4*t*t*t : 1 - Math.pow(-2*t+2,3)/2; // easeInOutCubic
    angle = startA + (target - startA)*ease;
    drawWheel();
    if(t < 1){ requestAnimationFrame(anim); }
    else { spinning=false; tickLoopStop(); showResult(); }
  })(t0);
}
function getSelectedIndex(){
  const n=Math.max(items.length,1), arc=TWO_PI/n;
  const a=(TWO_PI - (angle % TWO_PI) + arc/2) % TWO_PI;
  return Math.floor(a/arc) % n;
}
function showResult(){
  const idx=getSelectedIndex();
  const pick=items[idx];
  resultBadge.textContent = `ğŸ‰ ë‹¹ì²¨: ${pick}`;
  resultBadge.style.display='inline-block';
  playSound('win');
  if(!allowDuplicate){
    items.splice(idx,1);
    renderChips(); saveState(); drawWheel();
  }
}
function hideResult(){ resultBadge.style.display='none'; }
resultBadge.addEventListener('click', hideResult);

/* ===== SOUNDS (optional) ===== */
let tickTimer=null;
function playSound(name){
  const srcs = {
    tick:'assets/sounds/tick-fast.mp3',
    win:'assets/sounds/win.mp3',
    btn:'assets/sounds/button.mp3'
  };
  const src = srcs[name]; if(!src) return;
  const a = new Audio(src); a.volume = name==='tick' ? .25 : .6; a.play().catch(()=>{});
}
function tickLoopStart(){ tickLoopStop(); tickTimer=setInterval(()=>playSound('tick'), 80); }
function tickLoopStop(){ if(tickTimer){ clearInterval(tickTimer); tickTimer=null; } }

/* ===== UI ===== */
function renderChips(){
  chipList.innerHTML='';
  items.forEach((v,i)=>{
    const el=document.createElement('span');
    el.className='chip';
    el.innerHTML=`<span>${escapeHtml(v)}</span><button title="ì‚­ì œ" data-i="${i}">âœ•</button>`;
    chipList.appendChild(el);
  });
}
chipList.addEventListener('click', e=>{
  if(e.target.tagName==='BUTTON'){
    const i=+e.target.dataset.i; items.splice(i,1);
    renderChips(); saveState(); drawWheel();
  }
});

/* ---- BUG FIX: 'ë“±' ë‹¨ë… ì…ë ¥ ë°©ì§€ & ì •ê·œí™” ---- */
function sanitizeValue(raw){
  let v = (raw||'').replace(/\s+/g, ' ').trim();
  // í”í•œ êµ¬ë‘ì  ì œê±°(ëì— ë¶™ì€ , ; / ë“±)
  v = v.replace(/[,\u3001;\/\\]+$/,'').trim();
  // ë‹¨ë… 'ë“±'ì€ ë¬´ì‹œ (IME/ì—”í„° ì¡°í•© ì´ìŠˆ ë°©ì§€)
  if (v === 'ë“±') return '';
  return v;
}
function addFromInput(){
  const ipt=document.getElementById('itemInput');
  const val=sanitizeValue(ipt.value);
  if(!val) return;
  items.push(val);
  ipt.value='';
  renderChips(); saveState(); drawWheel(); playSound('btn');
}
document.getElementById('itemInput').addEventListener('keydown', e=>{
  if(e.key==='Enter'){ e.preventDefault(); addFromInput(); }
});
document.getElementById('btnAdd').addEventListener('click', addFromInput);

document.getElementById('btnShuffle').addEventListener('click', ()=>{
  shuffle(items); renderChips(); saveState(); drawWheel(); playSound('btn');
});
document.getElementById('chkDupe').addEventListener('change', e=>{
  allowDuplicate=e.target.checked; saveState(); playSound('btn');
});
document.getElementById('btnStart').addEventListener('click', ()=>{ playSound('btn'); spin(); });
document.getElementById('btnReset').addEventListener('click', ()=>{ angle=0; drawWheel(); hideResult(); playSound('btn'); });

let zoom=1;
document.getElementById('btnZoomIn').addEventListener('click', ()=>{ zoom = clamp(zoom+0.1, .6, 1.6); document.querySelector('.left').style.transform=`scale(${zoom})`; document.querySelector('.left').style.transformOrigin='top left'; });
document.getElementById('btnZoomOut').addEventListener('click', ()=>{ zoom = clamp(zoom-0.1, .6, 1.6); document.querySelector('.left').style.transform=`scale(${zoom})`; document.querySelector('.left').style.transformOrigin='top left'; });
document.getElementById('btnZoomReset').addEventListener('click', ()=>{ zoom=1; document.querySelector('.left').style.transform='none'; });

document.getElementById('chkTheme').addEventListener('change', e=>{
  const mode = e.target.checked ? 'light' : 'dark';
  document.documentElement.setAttribute('data-theme', mode);
  saveState();
});

/* ===== BIG SCREEN (same theme) ===== */
document.getElementById('btnBig').addEventListener('click', ()=>{
  saveState();
  const w = window.open('', '_blank', 'width=1200,height=1000');
  w.document.write(bigHtml(document.documentElement.getAttribute('data-theme')||'dark'));
  w.document.close();
});

function bigHtml(theme){
  const html = `
<!DOCTYPE html><html lang="ko" data-theme="${theme}"><head><meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ëŒ€í˜• ë£°ë ›</title>
<style>
  :root{ --bg:#0a0d1f; --tx:#fff; }
  html[data-theme="light"]{ --bg:#f6f7fb; --tx:#101322; }
  html,body{height:100%;margin:0;background:var(--bg);color:var(--tx);font-family:ui-sans-serif,system-ui,'Noto Sans KR',sans-serif}
  .stage{display:grid;place-items:center;height:100%;gap:16px}
  .pointer{width:0;height:0;border-left:20px solid transparent;border-right:20px solid transparent;border-top:30px solid #ff5a5a;filter:drop-shadow(0 10px 14px rgba(0,0,0,.45))}
  canvas{width:min(92vmin,1200px);height:min(92vmin,1200px)}
  .controls{position:fixed;right:16px;top:16px;display:flex;gap:8px}
  .btn{all:unset;background:#1a1f42d9;border:1px solid #3a47b8aa;padding:10px 14px;border-radius:12px;cursor:pointer;font-weight:800}
  html[data-theme="light"] .btn{background:#ffffffdd;border-color:#c9d1ff;color:#1a237e}
</style>
</head><body>
<div class="controls">
  <button class="btn" id="start">â–¶ ì‹œì‘</button>
  <button class="btn" id="reset">â†º ì´ˆê¸°í™”</button>
</div>
<div class="stage">
  <div class="pointer"></div>
  <canvas id="C" width="1400" height="1400"></canvas>
  <div id="R" style="font-size:28px;font-weight:900"></div>
</div>
<script>
  const C=document.getElementById('C'), X=C.getContext('2d');
  let items=JSON.parse(localStorage.getItem('roullet_items')||'[]');
  let allow=localStorage.getItem('roullet_allowDupe')==='1';
  let ang=0, spin=false; const PI=Math.PI*2;
  function draw(){
    const W=C.width,H=C.height; X.clearRect(0,0,W,H);
    X.save(); X.translate(W/2,H/2); X.rotate(ang);
    const n=Math.max(items.length,1), arc=PI/n, R=Math.min(W,H)/2-16;
    for(let i=0;i<n;i++){
      const s=i*arc, e=s+arc, hue=Math.floor((360/n)*i);
      X.beginPath(); X.moveTo(0,0); X.arc(0,0,R,s,e); X.closePath();
      X.fillStyle=\`hsl(\${hue} 75% 52%)\`; X.fill();
      X.strokeStyle="rgba(5,10,30,.55)"; X.lineWidth=8;
      X.beginPath(); X.arc(0,0,R,s,e); X.stroke();
      X.save(); X.rotate(s+arc/2);
      X.fillStyle="#fff"; X.font="700 48px ui-sans-serif,'Noto Sans KR'";
      X.textAlign="center"; X.textBaseline="middle";
      X.fillText(items[i]??"", R*0.72, 0); X.restore();
    }
    X.restore();
  }
  function idx(){ const n=Math.max(items.length,1), arc=PI/n; const a=(PI - (ang%PI) + arc/2)%PI; return Math.floor(a/arc)%n; }
  function start(){
    if(spin||items.length===0) return;
    const base=6*360, extra=Math.random()*360, tgt=ang+(base+extra)*(Math.PI/180);
    const dur=3200+Math.random()*900, s=ang, t0=performance.now(); spin=true;
    (function anim(now){ const t=Math.min((now-t0)/dur,1);
      const ease=t<.5?4*t*t*t:1-Math.pow(-2*t+2,3)/2;
      ang=s+(tgt-s)*ease; draw(); if(t<1) requestAnimationFrame(anim); else { spin=false; done(); }})(t0);
  }
  function done(){ const i=idx(), pick=items[i]; document.getElementById('R').textContent='ğŸ‰ '+pick+' ğŸ‰'; if(!allow){ items.splice(i,1); localStorage.setItem('roullet_items', JSON.stringify(items)); draw(); } }
  document.getElementById('start').onclick=start;
  document.getElementById('reset').onclick=()=>{ ang=0; draw(); document.getElementById('R').textContent=''; };
  draw();
<\/script>
</body></html>`;
  return html;
}

/* ===== INIT ===== */
loadState();
renderChips();
drawWheel();
</script>
</body>
</html>
